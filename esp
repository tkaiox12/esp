-- LocalScript (colocar em StarterPlayerScripts)
-- Pressione T para alternar Highlights para TODOS os jogadores.
-- USO LEGÍTIMO: apenas no seu próprio jogo / para depuração. Não use para trapacear em jogos de terceiros.

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local localPlayer = Players.LocalPlayer
local enabled = false

-- Configurações
local OUTLINE_COLOR = Color3.fromRGB(255, 0, 0)
local FILL_TRANSPARENCY = 1        -- 1 = sem preenchimento
local OUTLINE_TRANSPARENCY = 0     -- 0 = contorno visível
local HIGHLIGHT_NAME = "DevAlwaysOnTopHighlight"

local highlights = {} -- [player] = highlightInstance

local function createHighlightForPlayer(player)
	if not player or not player.Character then return end
	-- evita duplicação
	if highlights[player] and highlights[player].Parent then return end

	local hl = Instance.new("Highlight")
	hl.Name = HIGHLIGHT_NAME
	hl.Adornee = player.Character
	hl.FillTransparency = FILL_TRANSPARENCY
	hl.OutlineColor = OUTLINE_COLOR
	hl.OutlineTransparency = OUTLINE_TRANSPARENCY
	-- Faz com que o highlight seja renderizado sobre objetos (através de paredes)
	hl.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	hl.Parent = workspace
	highlights[player] = hl
end

local function removeHighlightForPlayer(player)
	local hl = highlights[player]
	if hl then
		pcall(function() hl:Destroy() end)
		highlights[player] = nil
	end
end

local function clearAllHighlights()
	for p, _ in pairs(highlights) do
		removeHighlightForPlayer(p)
	end
end

local function applyHighlightsToAll()
	clearAllHighlights()
	for _, p in pairs(Players:GetPlayers()) do
		-- inclui também o próprio jogador; remova a linha abaixo se quiser ignorar o localPlayer
		if p.Character and p.Character:FindFirstChild("Humanoid") then
			createHighlightForPlayer(p)
		end
	end
end

-- Eventos para manter highlights atualizados
Players.PlayerAdded:Connect(function(p)
	p.CharacterAdded:Connect(function()
		if enabled then
			createHighlightForPlayer(p)
		end
	end)
end)

Players.PlayerRemoving:Connect(function(p)
	removeHighlightForPlayer(p)
end)

-- toggle com tecla T
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.UserInputType == Enum.UserInputType.Keyboard and input.KeyCode == Enum.KeyCode.T then
		enabled = not enabled
		if enabled then
			applyHighlightsToAll()
		else
			clearAllHighlights()
		end
	end
end)

-- Opcional: começar ativado
-- enabled = true
-- applyHighlightsToAll()
